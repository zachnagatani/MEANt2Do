"use strict";!function(){angular.module("meantodo",["ui.router","ngMessages"]),angular.module("meantodo").config(["$stateProvider","$urlRouterProvider",function(o,t){o.state("login",{url:"/login",templateUrl:"templates/login.html",controller:"loginCtrl as vm"}).state("signup",{url:"/signup",templateUrl:"templates/signup.html",controller:"signupCtrl as vm"}).state("dashboard",{url:"/dashboard",templateUrl:"templates/dashboard.html",controller:"dashboardCtrl as vm"}),t.otherwise("/login")}])}(),function(){angular.module("meantodo").service("apiGET",["$http",function(o){var t=this;t.get=function(t,n){return o.get(t,n)}}]),angular.module("meantodo").service("apiPOST",["$http",function(o){var t=this;t.post=function(t,n,e){return o.post(t,n,e)}}]),angular.module("meantodo").service("apiDELETE",["$http",function(o){var t=this;t.delete=function(t,n){return o.delete(t,n)}}]),angular.module("meantodo").service("authentication",["$http","$window",function(o,t){var n=this;n.saveToken=function(o){t.localStorage["mean-token"]=o},n.getToken=function(){return t.localStorage["mean-token"]},n.logout=function(){t.localStorage.removeItem("mean-token")},n.isLoggedIn=function(){var o,e=n.getToken();return!!e&&(o=e.split(".")[1],o=t.atob(o),o=JSON.parse(o),o.exp>Date.now()/1e3)},n.currentUser=function(){if(n.isLoggedIn()){var o=n.getToken(),e=o.split(".")[1];return e=t.atob(e),e=JSON.parse(e),{username:e.username}}}}])}(),function(){angular.module("meantodo").controller("indexCtrl",["$scope","$state","authentication",function(o,t,n){var e=this;e.isLoggedIn=n.isLoggedIn(),e.currentUser=n.currentUser(),e.logout=function(o){e.isLoggedIn=!1,n.logout(),t.go("login")},o.$on("loggedIn",function(o,t){e.isLoggedIn=t})}])}(),function(){angular.module("meantodo").controller("signupCtrl",["$scope","$state","apiPOST","authentication",function(o,t,n,e){var a=this;URL="https://tranquil-headland-44852.herokuapp.com/api/users/signup",a.state="Signup",a.signup=function(i,r,u){u.preventDefault(),n.post(URL,{username:i,password:r}).then(function(n){200===n.status&&(e.saveToken(n.data.token),o.$emit("loggedIn",e.isLoggedIn()),t.go("dashboard"))},function(o){a.usernameConflict=!0})}}])}(),function(){angular.module("meantodo").controller("loginCtrl",["$scope","$state","apiPOST","authentication",function(o,t,n,e){var a=this;URL="https://tranquil-headland-44852.herokuapp.com/api/users/login",a.state="Login",a.login=function(i,r,u){u.preventDefault(),n.post(URL,{username:i,password:r}).then(function(n){200===n.status&&(e.saveToken(n.data.token),t.go("dashboard"),o.$emit("loggedIn",e.isLoggedIn()))},function(o){a.formInvalid=!0})}}])}(),function(){angular.module("meantodo").controller("dashboardCtrl",["$scope","$state","authentication","apiGET","apiPOST","apiDELETE",function(o,t,n,e,a,i){var r=this,u="https://tranquil-headland-44852.herokuapp.com/api/todos",s="https://tranquil-headland-44852.herokuapp.com/api/todos/new",d="https://tranquil-headland-44852.herokuapp.com/api/todos/update",l=n.getToken();n.isLoggedIn()||t.go("login"),r.getTodos=function(){e.get(u,{headers:{Authorization:"Bearer "+l}}).then(function(o){r.todos=o.data})},r.getTodos(),r.addTodo=function(t,n){n.preventDefault(),o.todo&&a.post(s,{todo:t},{headers:{Authorization:"Bearer "+l}}).then(function(t){o.todo="",r.getTodos()},function(o){console.log(o)})},r.enterEditing=function(o){r.editing=!0,r.currentTodo=o,$("#todo").focus()},r.updateTodo=function(t,n,e){e&&e.preventDefault(),a.post(d,{id:t._id,todo:n,isDone:t.isDone},{headers:{Authorization:"Bearer "+l}}).then(function(t){r.editing=!1,o.todo="",r.getTodos()},function(o){console.log(o)})},r.cancelEdit=function(){o.todo||(r.editing=!1)},r.checkTodo=function(o){r.currentTodo=o,r.currentTodo.isDone===!1?r.currentTodo.isDone=!0:r.currentTodo.isDone=!1,r.updateTodo(r.currentTodo,r.currentTodo.todo)},r.deleteTodo=function(o){var t="https://tranquil-headland-44852.herokuapp.com/api/todos/delete/"+o._id;i.delete(t,{headers:{Authorization:"Bearer "+l}}).then(function(o){r.getTodos()},function(o){console.log(o)})}}])}();